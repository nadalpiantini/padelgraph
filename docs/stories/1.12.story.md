# Story 1.12: PayPal Integration E2E Testing

**Epic**: 1
**Story ID**: 1.12
**Status**: Draft
**Priority**: Critical
**Estimated Effort**: 6-8 hours
**Dependencies**: Stories 1.1-1.11 (all Epic 1 stories)

---

## ðŸ“– User Story

**As a** development team
**I want** comprehensive E2E tests for PayPal integration
**So that** we ensure subscription flows work reliably

---

## âœ… Acceptance Criteria

1. E2E test suite created with Playwright
2. Test: Complete subscription purchase flow (Sandbox)
3. Test: Webhook event processing
4. Test: Usage limit enforcement
5. Test: Subscription cancellation
6. Test: Subscription resume
7. Test: Payment history display
8. All tests passing in CI/CD
9. Test coverage >80% for PayPal code

---

## ðŸ”§ Dev Notes

**Test File**: `tests/e2e/subscriptions/paypal-flow.spec.ts`

**Test Scenarios**:
```typescript
describe('PayPal Subscription Flow', () => {
  test('User can subscribe to Pro plan', async ({ page }) => {
    // 1. Navigate to pricing
    // 2. Click "Subscribe to Pro"
    // 3. Redirected to PayPal
    // 4. Complete payment in Sandbox
    // 5. Redirected back with success
    // 6. Subscription shows as active
  });

  test('Webhook updates subscription status', async () => {
    // 1. Create test subscription
    // 2. Send webhook event (ACTIVATED)
    // 3. Verify subscription status = active
    // 4. Verify database updated
  });

  test('Usage limits enforced correctly', async ({ page }) => {
    // 1. Create free tier user
    // 2. Make 11 recommendations (limit = 10)
    // 3. 11th should fail with 429
  });

  test('User can cancel subscription', async ({ page }) => {
    // 1. Go to billing page
    // 2. Click cancel
    // 3. Confirm in modal
    // 4. Verify cancel_at_period_end = true
  });
});
```

[Source: Existing E2E pattern in tests/e2e/discovery/]

---

## ðŸ“‹ Tasks

1. Create E2E test file
2. Setup PayPal Sandbox test account
3. Write subscription flow test
4. Write webhook test
5. Write usage limits test
6. Write cancel/resume tests
7. Run tests locally
8. Configure in CI/CD
9. Document test credentials

---

**Created**: 2025-10-18
