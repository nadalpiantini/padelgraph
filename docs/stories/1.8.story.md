# Story 1.8: Cancel & Resume Subscription APIs

**Epic**: 1
**Story ID**: 1.8
**Status**: Draft
**Priority**: High
**Estimated Effort**: 3-4 hours
**Dependencies**: Story 1.1 (PayPal SDK), Story 1.2 (Database)

---

## ðŸ“– User Story

**As a** subscriber
**I want** to cancel or resume my subscription
**So that** I have control over my billing

---

## âœ… Acceptance Criteria

1. POST /api/subscriptions/cancel endpoint created
2. POST /api/subscriptions/resume endpoint created
3. Cancel: Calls PayPal API to cancel subscription
4. Cancel: Updates database status
5. Resume: Reactivates canceled subscription
6. Both require authentication
7. Prevents cancel if already canceled
8. Prevents resume if not canceled

---

## ðŸ”§ Dev Notes

**Files**:
- `src/app/api/subscriptions/cancel/route.ts`
- `src/app/api/subscriptions/resume/route.ts`

**Implementation**: Use PayPal SDK subscription management methods

**Cancel Logic**:
```typescript
// Cancel at end of billing period
await paypalClient.execute({
  method: 'POST',
  path: `/v1/billing/subscriptions/${subscription_id}/cancel`,
  body: {
    reason: user_provided_reason
  }
});

// Update DB
await supabase
  .from('subscriptions')
  .update({
    cancel_at_period_end: true,
    canceled_at: new Date().toISOString()
  })
  .eq('id', subscription_id);
```

---

## ðŸ“‹ Tasks

1. Create cancel route file
2. Implement PayPal cancel call
3. Update database
4. Create resume route file
5. Implement PayPal resume call
6. Unit tests
7. Integration tests with Sandbox

---

**Created**: 2025-10-18
