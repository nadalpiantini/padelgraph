# Story 1.7: Current Subscription API

**Epic**: 1
**Story ID**: 1.7
**Status**: Draft
**Priority**: High
**Estimated Effort**: 2-3 hours
**Dependencies**: Story 1.2 (Database schema)

---

## ðŸ“– User Story

**As a** logged-in user
**I want** to view my current subscription details
**So that** I know my plan status and usage limits

---

## âœ… Acceptance Criteria

1. GET /api/subscriptions/current endpoint created
2. Returns user's active subscription
3. Includes plan details and features
4. Includes usage statistics
5. Returns null if no active subscription (free tier)
6. Requires authentication
7. Response time <200ms

---

## ðŸ”§ Dev Notes

**File**: `src/app/api/subscriptions/current/route.ts`

**Implementation**: Similar to `src/app/api/profile/route.ts` pattern

**Response**:
```typescript
{
  subscription: {
    id: string;
    plan_id: string;
    status: string;
    current_period_start: string;
    current_period_end: string;
    cancel_at_period_end: boolean;
  } | null;
  plan_details: SubscriptionPlan;
  usage: {
    tournaments: { used: number; limit: number | 'unlimited' };
    auto_match: { used: number; limit: number | 'unlimited' };
    recommendations: { used: number; limit: number | 'unlimited' };
    travel_plans: { used: number; limit: number | 'unlimited' };
  };
}
```

---

## ðŸ“‹ Tasks

1. Create API route file
2. Implement auth check
3. Query subscriptions table
4. Fetch usage statistics from usage_logs
5. Combine subscription + plan + usage
6. Return formatted response
7. Unit tests
8. Integration test

---

**Created**: 2025-10-18
