# Story 5.1: Referral Program Database & Logic

**Epic**: 5 - Growth Features
**Story ID**: 5.1
**Priority**: High
**Effort**: 5-6 hours

---

## ðŸ“– User Story

**As a** user
**I want** to refer friends and earn rewards
**So that** I get benefits for growing the platform

---

## âœ… Acceptance Criteria

1. referrals table created
2. referral_rewards table created
3. Unique referral code per user
4. Track referral conversions
5. Reward attribution (free month, credits, etc.)
6. API endpoints for referrals
7. Prevent self-referrals and fraud

---

## ðŸ”§ Dev Notes

**Schema**:
```sql
CREATE TABLE referrals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  referrer_id UUID NOT NULL REFERENCES user_profile(id),
  referred_id UUID REFERENCES user_profile(id),
  referral_code TEXT UNIQUE NOT NULL,
  status TEXT NOT NULL, -- pending, completed, rewarded
  converted_at TIMESTAMPTZ,
  reward_given BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE referral_rewards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES user_profile(id),
  referral_id UUID NOT NULL REFERENCES referrals(id),
  reward_type TEXT NOT NULL, -- free_month, credits, upgrade
  reward_value INTEGER,
  redeemed BOOLEAN DEFAULT FALSE,
  redeemed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## ðŸ“‹ Tasks

1. Create migration with referrals tables
2. Generate unique referral codes
3. Create referral tracking logic
4. Implement reward distribution
5. Create referral APIs
6. Fraud prevention
7. Unit tests
8. Integration tests

---

**Created**: 2025-10-18
